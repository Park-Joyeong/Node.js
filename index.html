<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>This is my node server.</title>
</head>

<body>
  <h1><span id="user-name"></span> 님 환영합니다!</h1>
  <div id="chatBox" style="width:70vw; height:50vh; border-style: dotted;">

  </div>
  <form style="width:70vw;">
    <fieldset>
      <span>To:&nbsp;</span>
      <select id="socketID" name="socketID">
        <option value=''>Everyone</option>
      </select>
      <input type="text" id="message" name="message" size="50">
      <input type="submit" value="Send">
    </fieldset>
  </form>

  <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js"></script>
  <script>
    var socket = io();
    var myUserId;
    var mySocketId;
    var clients = {};

    socket.on('forMe', function (obj) {
      myUserId = obj['userId'];
      mySocketId = obj['socketId'];
      $('#user-name').html(myUserId);

    });
    socket.on('new', function (obj) {
      clients = obj['clients'];
      // $('#socketID')
    });

    $('form').submit(function (e) {
      e.preventDefault();
      var socketID = $('#socketID').val();
      var message = $('#message').val();

      var strObj = '{ "socketID": "' + socketID + '" }';
      var json_data = JSON.parse("{}");
      json_data.socketID = socketID;
      json_data.message = message;
      socket.emit('sendMessage', json_data);
    });



    socket.on('receiveMessage', function (rtnObj) {
      var {
        senderSocketID,
        targetSocketID,
        message
      } = rtnObj;

      var senderUserId = clients[senderSocketID];

      // console.log('userID:', senderUserId)
      // console.log(senderSocketID)
      // console.log(targetSocketID)
      // console.log(message)

      if (targetSocketID === '') {//for everyone
        
        console.log(senderSocketID)
        console.log(mySocketId)
        if (senderSocketID === mySocketId) {
          $('#chatBox').append("<p style='color:red;'>Me" + ':&nbsp;' + message + "</p>");
        } else {
          $('#chatBox').append("<p>" + senderUserId + ':&nbsp;' + message + "</p>");
        }
          
      } else {

      }

      // var json_data = JSON.parse(msg);

      // $('#messages').append("<p>" + json_data.name + "</p>");
      // $('#messages').append("<p>" + msg + "</p>");
    });





  </script>
</body>

</html>